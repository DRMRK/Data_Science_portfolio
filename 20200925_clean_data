{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Process dataset.\n",
    "\n",
    "- read data from pkl format onto a dataframe\n",
    "- replace null/nan values with median\n",
    "- remove columns that do not have predictive power\n",
    "- extract extra features from the datetime column\n",
    "- remove columns that have data leakage from target\n",
    "- convert columns with text information to columns with categorical types\n",
    "- convert object types to integer and float\n",
    "- target encode some categorical columns\n",
    "- one hot encode some categorical columns\n",
    "- save the dataframe for further analysis \n",
    "- dataframe saved in Cleaned_Trips2016_10.csv, issue types of varibales not preserved.\n",
    "- Solution is to save dataframe in feather format "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Applications/anaconda3/envs/DNN/lib/python3.7/site-packages/sklearn/utils/deprecation.py:143: FutureWarning: The sklearn.ensemble.forest module is  deprecated in version 0.22 and will be removed in version 0.24. The corresponding classes / functions should instead be imported from sklearn.ensemble. Anything that cannot be imported from sklearn.ensemble is now part of the private API.\n",
      "  warnings.warn(message, FutureWarning)\n"
     ]
    }
   ],
   "source": [
    "import sys\n",
    "import os\n",
    "\n",
    "current_path = os.path.abspath(os.path.join('..'))\n",
    "if current_path not in sys.path:\n",
    "    sys.path.append(current_path)\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "from helper.imports import *\n",
    "from helper.structured  import *\n",
    "from IPython.display import display\n",
    "import matplotlib.pyplot as plt \n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "# setUp the display \n",
    "def display_all(df):\n",
    "    with pd.option_context(\"display.max_rows\", 1000, \"display.max_columns\", 1000): \n",
    "        display(df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Metadata\n",
    "<table style=\"width:100%\">\n",
    "    <tr><td><b>OperationDate</b></td> <td>The operation date</td></tr>\n",
    "    <tr><td><b>Day Type</b></td> <td>Weekend or Weekday</td></tr>\n",
    "    <tr><td><b>Vehicle No</b></td> <td>Vehicle unique identifier</td></tr>\n",
    "    <tr><td><b>Block No</b></td> <td>Block unique identifier</td></tr>\n",
    "    <tr><td><b>Pattern</b></td> <td>The scheduled trip identifier (from starting station to ending station), line number</td></tr>\n",
    "    <tr><td><b>Trip</b></td> <td>The scheduled trip identifier (from starting station to ending station), line number, and starting time</td></tr>\n",
    "    <tr><td><b>Line</b></td> <td>Also known as bus stop number</td></tr>\n",
    "    <tr><td><b>Timing Point</b></td> <td>A particular bus stop that the bus can stop at so that the driver is not too ahead of schedule.</td></tr>\n",
    "    <tr><td><b>Min Stop No</b></td> <td>Always going to be 1.</td></tr>\n",
    "    <tr><td><b>Max Stop No</b></td> <td>Basically just the number of total stops that this particular bus line has.</td></tr>\n",
    "    <tr><td><b>Stop Name</b></td> <td>The stop name</td></tr>\n",
    "    <tr><td><b>Arrive Load Compensated</b></td> <td>How many people were calculated to be on the bus at this particular bus stop arrival.</td></tr>\n",
    "    <tr><td><b>Ons Load Compensated</b></td> <td>How many people got on the bus at this particular bus stop arrival.</td></tr>\n",
    "    <tr><td><b>Offs Load Compensated</b></td> <td>How many people got off the bus at this particular bus stop arrival.</td></tr>\n",
    "    <tr><td><b>Leave Load Compensated</b></td> <td>How many people were still on the bus after it leaves the bus stop.</td></tr>\n",
    "    <tr><td><b>Scheduled Arrive Time</b></td> <td>When the bus was scheduled to arrive. (ignore)</td></tr>\n",
    "    <tr><td><b>Actual Arrive Time</b></td> <td>When the bus actually arrived. (ignore)</td></tr>\n",
    "    <tr><td><b>Scheduled Leave Time</b></td> <td>When the bus was scheduled to leave. (ignore)</td></tr>\n",
    "    <tr><td><b>Actual Leave Time</b></td> <td>When the bus actually left. (ignore)</td></tr>\n",
    "    <tr><td><b>WC Lift Activated</b></td> <td>Did the wheelchair lift activate (Y/N)</td></tr>\n",
    "    <tr><td><b>Bike Loaded</b></td> <td>Was a bike added  (Y/N)</td></tr>\n",
    "    <tr><td><b>Bike Unloaded</b></td> <td>Was a bike unloaded (Y/N)</td></tr>\n",
    "    <tr><td><b>Dwell Time</b></td> <td>How long the bus stayed at this stop.</td></tr>\n",
    "    <tr><td><b>Arrive Delay</b></td> <td>How far behind in seconds was the bus arrival according to schedule.</td></tr>\n",
    "    <tr><td><b>Departure Delay</b></td> <td>How far behind in seconds was the bus departure according to schedule.</td></tr>\n",
    "    <tr><td><b>Ons and Offs Compensated</b></td> <td>Ons + Offs</td></tr>\n",
    "    <tr><td><b>Temp</b></td> <td>Temperature</td></tr>\n",
    "    <tr><td><b>Dew</b></td> <td>Was it a \"dewy\" kinda day.</td></tr>\n",
    "    <tr><td><b>Humidity</b></td> <td>What the humidity of that day was. (I assume this is grams of water vapor / cubic meter of air )</td></tr>\n",
    "    <tr><td><b>Conditions</b></td> <td>Self-explanatory</td></tr>\n",
    "    <tr><td><b>Visibility</b></td> <td>Not sure what units this uses</td></tr>\n",
    "    <tr><td><b>Wind Speed</b></td> <td>Wind kilometres / hour?</td></tr>\n",
    "    <tr><td><b>Stop To Stop Time</b></td> <td>Number of seconds from stop A to stop B.</td></tr>\n",
    "    <tr><td><b>Travel Time</b></td> <td>Stop to Stop Time + Dwell Time</td></tr>\n",
    "    <tr><td><b>Leg</b></td> <td>e.g., Leg 2 is the second stop of this overall line</td></tr>\n",
    "    <tr><td><b>Origin</b></td> <td>Bus stop identifier that was point A in this set.</td></tr>\n",
    "    <tr><td><b>Origin Lat/Long</b></td> <td>The geographic latitude and longitude for the origin of this trip.</td></tr>\n",
    "    <tr><td><b>Destination</b></td> <td>Bus stop identifier that was point B in this set.</td></tr>\n",
    "    <tr><td><b>Destination Lat/Long</b></td> <td>The geographic latitude and longitude for the destination of this trip.</td></tr>\n",
    "    <tr><td><b>Start.Stop</b></td> <td>A->B</td></tr>\n",
    "    <tr><td><b>Distance.GglMps</b></td> <td>The distance from A to B in metres according to Google</td></tr>\n",
    "    <tr><td><b>Duration.GglMps</b></td> <td>The number of seconds that it would take from A to B according to Google</td></tr>\n",
    "    <tr><td><b>Scheduled Headway</b></td> <td>The recommended number of seconds between this vehicle and the vehicle ahead of it.</td></tr>\n",
    "    <tr><td><b>Actual Headway</b></td> <td>The actual number of seconds between this vehicle and the vehicle ahead of it.</td></tr>\n",
    "    <tr><td><b>Headway Within Target</b></td> <td>Is the headway within target (1/0).</td></tr>\n",
    "    <tr><td><b>Headway Offset</b></td> <td>Scheduled headway minus actual headway.</td></tr>\n",
    "    <tr><td><b>Bus Bunching Flag</b></td> <td>Is the bus in front of this bus, and too close? (1/0) (also using this column should be considered cheating!).</td></tr>\n",
    "    <tr><td><b>Bus Gapping Flag</b></td> <td>Is the bus in front of this bus too far away? (1/0).</td></tr>\n",
    "    <tr><td><b>Trip Pattern Completeness</b></td> <td>The % of completeness of the number of stops visited. (using this column would probably be a bit of information leakage)</td></tr>\n",
    "    <tr><td><b>Next Leg Bunching Flag</b></td> <td>Is the next trip going to suffer from bus bunching? (B->C)</td></tr>\n",
    "    <tr><td><b>Next Next Leg Bunching Flag</b></td> <td>\" \" \" \" \" \" \" \" \" \" (C->D)</td></tr>\n",
    "    <tr><td><b>Next Next Next Leg Bunching Flag</b></td> <td>\" \" \" \" \" \" \" \" \" \" (D->E)</td></tr>\n",
    "\n",
    "    \n",
    "</table>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Read the data from pkl file.\n",
    "df = pd.read_pickle(f'{current_path}/data/original/Trips2016_10.pkl')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 142640 entries, 0 to 142639\n",
      "Data columns (total 59 columns):\n",
      " #   Column                          Non-Null Count   Dtype \n",
      "---  ------                          --------------   ----- \n",
      " 0   OperationDate                   142640 non-null  object\n",
      " 1   DayType                         142640 non-null  object\n",
      " 2   VehicleNo                       142640 non-null  object\n",
      " 3   BlockNo                         142640 non-null  object\n",
      " 4   Pattern                         142640 non-null  object\n",
      " 5   Trip                            142640 non-null  object\n",
      " 6   Line                            142640 non-null  object\n",
      " 7   TimingPoint                     142640 non-null  object\n",
      " 8   MinStopNo                       142640 non-null  int64 \n",
      " 9   MaxStopNo                       142640 non-null  int64 \n",
      " 10  StopName                        142640 non-null  object\n",
      " 11  ArriveLoadCompensated           142640 non-null  object\n",
      " 12  OnsLoadCompensated              142640 non-null  object\n",
      " 13  OffsLoadCompensated             142640 non-null  object\n",
      " 14  LeaveLoadCompensated            142640 non-null  object\n",
      " 15  ScheduledArriveTime             142640 non-null  object\n",
      " 16  ActualArriveTime                142640 non-null  object\n",
      " 17  ScheduledLeaveTime              142640 non-null  object\n",
      " 18  ActualLeaveTime                 142640 non-null  object\n",
      " 19  WCLiftActivated                 142640 non-null  object\n",
      " 20  BikeLoaded                      142640 non-null  object\n",
      " 21  BikeUnloaded                    142640 non-null  object\n",
      " 22  DwellTime                       142640 non-null  object\n",
      " 23  ArriveDelay                     142640 non-null  int64 \n",
      " 24  DepartureDelay                  142640 non-null  int64 \n",
      " 25  OnsAndOffsCompensated           142640 non-null  int64 \n",
      " 26  Temp                            138752 non-null  object\n",
      " 27  Dew                             142640 non-null  object\n",
      " 28  Humidity                        138752 non-null  object\n",
      " 29  Conditions                      138752 non-null  object\n",
      " 30  Visibility                      138752 non-null  object\n",
      " 31  Wind.Speed                      138752 non-null  object\n",
      " 32  StopToStopTime                  142640 non-null  int64 \n",
      " 33  TravelTime                      142640 non-null  int64 \n",
      " 34  TripLeg                         142640 non-null  object\n",
      " 35  Origin                          142640 non-null  object\n",
      " 36  OriginLat                       142640 non-null  object\n",
      " 37  OriginLong                      142640 non-null  object\n",
      " 38  Destination                     142640 non-null  object\n",
      " 39  GPSLat                          142640 non-null  object\n",
      " 40  GPSLong                         142640 non-null  object\n",
      " 41  Start.Stop                      142640 non-null  object\n",
      " 42  Distance.GglMps                 142640 non-null  int64 \n",
      " 43  Duration.GglMps                 142640 non-null  int64 \n",
      " 44  ScheduledHeadway                142640 non-null  object\n",
      " 45  ActualHeadway                   142640 non-null  object\n",
      " 46  HeadwayWithinTarget             142640 non-null  object\n",
      " 47  HeadwayOffset                   142640 non-null  object\n",
      " 48  BusBunchingFlag                 142640 non-null  object\n",
      " 49  BusGappingFlag                  142640 non-null  object\n",
      " 50  TripPatternCompleteness         142640 non-null  object\n",
      " 51  StartScheduledLeaveTimeSeconds  142640 non-null  int64 \n",
      " 52  StartActualLeaveTimeSeconds     142640 non-null  int64 \n",
      " 53  StopScheduledArriveTiemSeconds  142640 non-null  int64 \n",
      " 54  StopActualArriveTimeSeconds     142640 non-null  int64 \n",
      " 55  TripLegInt                      142640 non-null  int64 \n",
      " 56  NextLegBunchingFlag             142640 non-null  int64 \n",
      " 57  NextNextLegBunchingFlag         142640 non-null  int64 \n",
      " 58  NextNextNextLegBunchingFlag     142640 non-null  int64 \n",
      "dtypes: int64(17), object(42)\n",
      "memory usage: 64.2+ MB\n"
     ]
    }
   ],
   "source": [
    "df.info()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Change dates to datetime format"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "df['OperationDate'] = pd.to_datetime(df['OperationDate'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Use a helper function to add new columns to data from the Operation date."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "add_datepart(df,'OperationDate')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>DayType</th>\n",
       "      <th>VehicleNo</th>\n",
       "      <th>Week</th>\n",
       "      <th>BlockNo</th>\n",
       "      <th>Pattern</th>\n",
       "      <th>Trip</th>\n",
       "      <th>Line</th>\n",
       "      <th>TimingPoint</th>\n",
       "      <th>MinStopNo</th>\n",
       "      <th>MaxStopNo</th>\n",
       "      <th>StopName</th>\n",
       "      <th>ArriveLoadCompensated</th>\n",
       "      <th>OnsLoadCompensated</th>\n",
       "      <th>OffsLoadCompensated</th>\n",
       "      <th>LeaveLoadCompensated</th>\n",
       "      <th>ScheduledArriveTime</th>\n",
       "      <th>ActualArriveTime</th>\n",
       "      <th>ScheduledLeaveTime</th>\n",
       "      <th>ActualLeaveTime</th>\n",
       "      <th>WCLiftActivated</th>\n",
       "      <th>BikeLoaded</th>\n",
       "      <th>BikeUnloaded</th>\n",
       "      <th>DwellTime</th>\n",
       "      <th>ArriveDelay</th>\n",
       "      <th>DepartureDelay</th>\n",
       "      <th>OnsAndOffsCompensated</th>\n",
       "      <th>Temp</th>\n",
       "      <th>Dew</th>\n",
       "      <th>Humidity</th>\n",
       "      <th>Conditions</th>\n",
       "      <th>Visibility</th>\n",
       "      <th>Wind.Speed</th>\n",
       "      <th>StopToStopTime</th>\n",
       "      <th>TravelTime</th>\n",
       "      <th>TripLeg</th>\n",
       "      <th>Origin</th>\n",
       "      <th>OriginLat</th>\n",
       "      <th>OriginLong</th>\n",
       "      <th>Destination</th>\n",
       "      <th>GPSLat</th>\n",
       "      <th>GPSLong</th>\n",
       "      <th>Start.Stop</th>\n",
       "      <th>Distance.GglMps</th>\n",
       "      <th>Duration.GglMps</th>\n",
       "      <th>ScheduledHeadway</th>\n",
       "      <th>ActualHeadway</th>\n",
       "      <th>HeadwayWithinTarget</th>\n",
       "      <th>HeadwayOffset</th>\n",
       "      <th>BusBunchingFlag</th>\n",
       "      <th>BusGappingFlag</th>\n",
       "      <th>TripPatternCompleteness</th>\n",
       "      <th>StartScheduledLeaveTimeSeconds</th>\n",
       "      <th>StartActualLeaveTimeSeconds</th>\n",
       "      <th>StopScheduledArriveTiemSeconds</th>\n",
       "      <th>StopActualArriveTimeSeconds</th>\n",
       "      <th>TripLegInt</th>\n",
       "      <th>NextLegBunchingFlag</th>\n",
       "      <th>NextNextLegBunchingFlag</th>\n",
       "      <th>NextNextNextLegBunchingFlag</th>\n",
       "      <th>OperationYear</th>\n",
       "      <th>OperationMonth</th>\n",
       "      <th>OperationDay</th>\n",
       "      <th>OperationDayofweek</th>\n",
       "      <th>OperationDayofyear</th>\n",
       "      <th>OperationIs_month_end</th>\n",
       "      <th>OperationIs_month_start</th>\n",
       "      <th>OperationIs_quarter_end</th>\n",
       "      <th>OperationIs_quarter_start</th>\n",
       "      <th>OperationIs_year_end</th>\n",
       "      <th>OperationIs_year_start</th>\n",
       "      <th>OperationElapsed</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Mon-Fri</td>\n",
       "      <td>2553</td>\n",
       "      <td>35</td>\n",
       "      <td>34132</td>\n",
       "      <td>010 - NB1DT</td>\n",
       "      <td>010 - NB1DT - 04:53</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>WB SW MARINE DR AT HEATHER ST</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>04:55:34</td>\n",
       "      <td>04:54:41</td>\n",
       "      <td>04:55:34</td>\n",
       "      <td>04:54:41</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>42</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>12.9</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>96</td>\n",
       "      <td>Mainly Clear</td>\n",
       "      <td>48.3</td>\n",
       "      <td>10</td>\n",
       "      <td>35</td>\n",
       "      <td>35</td>\n",
       "      <td>2</td>\n",
       "      <td>55896</td>\n",
       "      <td>49.20914</td>\n",
       "      <td>-123.11976</td>\n",
       "      <td>55670</td>\n",
       "      <td>49.20741</td>\n",
       "      <td>-123.12395</td>\n",
       "      <td>55896 -&gt; 55670</td>\n",
       "      <td>361</td>\n",
       "      <td>37</td>\n",
       "      <td>600</td>\n",
       "      <td>518</td>\n",
       "      <td>1</td>\n",
       "      <td>82</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>17662</td>\n",
       "      <td>17657</td>\n",
       "      <td>17734</td>\n",
       "      <td>17692</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>245</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>1472688000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Mon-Fri</td>\n",
       "      <td>2553</td>\n",
       "      <td>35</td>\n",
       "      <td>34132</td>\n",
       "      <td>010 - NB1DT</td>\n",
       "      <td>010 - NB1DT - 04:53</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>WB SW MARINE DR AT LAUREL ST</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>04:56:24</td>\n",
       "      <td>04:55:15</td>\n",
       "      <td>04:56:24</td>\n",
       "      <td>04:55:23</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>71</td>\n",
       "      <td>42</td>\n",
       "      <td>1</td>\n",
       "      <td>12.9</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>96</td>\n",
       "      <td>Mainly Clear</td>\n",
       "      <td>48.3</td>\n",
       "      <td>10</td>\n",
       "      <td>21</td>\n",
       "      <td>21</td>\n",
       "      <td>3</td>\n",
       "      <td>55670</td>\n",
       "      <td>49.20741</td>\n",
       "      <td>-123.12395</td>\n",
       "      <td>55898</td>\n",
       "      <td>49.20618</td>\n",
       "      <td>-123.12682</td>\n",
       "      <td>55670 -&gt; 55898</td>\n",
       "      <td>250</td>\n",
       "      <td>24</td>\n",
       "      <td>600</td>\n",
       "      <td>514</td>\n",
       "      <td>1</td>\n",
       "      <td>86</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>17734</td>\n",
       "      <td>17692</td>\n",
       "      <td>17784</td>\n",
       "      <td>17713</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>245</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>1472688000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Mon-Fri</td>\n",
       "      <td>2553</td>\n",
       "      <td>35</td>\n",
       "      <td>34132</td>\n",
       "      <td>010 - NB1DT</td>\n",
       "      <td>010 - NB1DT - 04:53</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>WB SW MARINE DR AT OAK ST</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>04:57:37</td>\n",
       "      <td>04:56:01</td>\n",
       "      <td>04:57:37</td>\n",
       "      <td>04:56:01</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>13</td>\n",
       "      <td>81</td>\n",
       "      <td>58</td>\n",
       "      <td>0</td>\n",
       "      <td>12.9</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>96</td>\n",
       "      <td>Mainly Clear</td>\n",
       "      <td>48.3</td>\n",
       "      <td>10</td>\n",
       "      <td>63</td>\n",
       "      <td>50</td>\n",
       "      <td>4</td>\n",
       "      <td>55898</td>\n",
       "      <td>49.20618</td>\n",
       "      <td>-123.12682</td>\n",
       "      <td>54736</td>\n",
       "      <td>49.20453</td>\n",
       "      <td>-123.13107</td>\n",
       "      <td>55898 -&gt; 54736</td>\n",
       "      <td>359</td>\n",
       "      <td>37</td>\n",
       "      <td>600</td>\n",
       "      <td>525</td>\n",
       "      <td>1</td>\n",
       "      <td>75</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>17784</td>\n",
       "      <td>17726</td>\n",
       "      <td>17857</td>\n",
       "      <td>17776</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>245</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>1472688000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Mon-Fri</td>\n",
       "      <td>2553</td>\n",
       "      <td>35</td>\n",
       "      <td>34132</td>\n",
       "      <td>010 - NB1DT</td>\n",
       "      <td>010 - NB1DT - 04:53</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>WB SW MARINE DR AT GRANVILLE ST</td>\n",
       "      <td>-1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-1</td>\n",
       "      <td>04:59:54</td>\n",
       "      <td>04:59:47</td>\n",
       "      <td>04:59:54</td>\n",
       "      <td>04:59:47</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>-9</td>\n",
       "      <td>-22</td>\n",
       "      <td>0</td>\n",
       "      <td>12.9</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>96</td>\n",
       "      <td>Mainly Clear</td>\n",
       "      <td>48.3</td>\n",
       "      <td>10</td>\n",
       "      <td>22</td>\n",
       "      <td>22</td>\n",
       "      <td>8</td>\n",
       "      <td>54681</td>\n",
       "      <td>49.20417</td>\n",
       "      <td>-123.13726</td>\n",
       "      <td>54682</td>\n",
       "      <td>49.20505</td>\n",
       "      <td>-123.13988</td>\n",
       "      <td>54681 -&gt; 54682</td>\n",
       "      <td>214</td>\n",
       "      <td>22</td>\n",
       "      <td>600</td>\n",
       "      <td>531</td>\n",
       "      <td>1</td>\n",
       "      <td>69</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>17959</td>\n",
       "      <td>17981</td>\n",
       "      <td>17994</td>\n",
       "      <td>18003</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>245</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>1472688000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Mon-Fri</td>\n",
       "      <td>2553</td>\n",
       "      <td>35</td>\n",
       "      <td>34132</td>\n",
       "      <td>010 - NB1DT</td>\n",
       "      <td>010 - NB1DT - 04:53</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>NB GRANVILLE ST AT W 71 AVE</td>\n",
       "      <td>-1</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>05:00:41</td>\n",
       "      <td>05:00:33</td>\n",
       "      <td>05:00:41</td>\n",
       "      <td>05:00:54</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>8</td>\n",
       "      <td>-9</td>\n",
       "      <td>2</td>\n",
       "      <td>13.1</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>96</td>\n",
       "      <td>Mainly Clear</td>\n",
       "      <td>48.3</td>\n",
       "      <td>7</td>\n",
       "      <td>30</td>\n",
       "      <td>30</td>\n",
       "      <td>9</td>\n",
       "      <td>54682</td>\n",
       "      <td>49.20505</td>\n",
       "      <td>-123.13988</td>\n",
       "      <td>54692</td>\n",
       "      <td>49.20743</td>\n",
       "      <td>-123.14041</td>\n",
       "      <td>54682 -&gt; 54692</td>\n",
       "      <td>289</td>\n",
       "      <td>43</td>\n",
       "      <td>600</td>\n",
       "      <td>535</td>\n",
       "      <td>1</td>\n",
       "      <td>65</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>17994</td>\n",
       "      <td>18003</td>\n",
       "      <td>18041</td>\n",
       "      <td>18033</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>245</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>False</td>\n",
       "      <td>1472688000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142635</th>\n",
       "      <td>Saturday</td>\n",
       "      <td>2562</td>\n",
       "      <td>52</td>\n",
       "      <td>21633</td>\n",
       "      <td>010 - SB1DT</td>\n",
       "      <td>010 - SB1DT - 15:02</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>EB SW MARINE DR AT MONTCALM ST</td>\n",
       "      <td>17</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>13</td>\n",
       "      <td>15:46:53</td>\n",
       "      <td>15:47:17</td>\n",
       "      <td>15:46:53</td>\n",
       "      <td>15:47:34</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>-25</td>\n",
       "      <td>-49</td>\n",
       "      <td>-4</td>\n",
       "      <td>0.6</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>97</td>\n",
       "      <td>\"Rain,Snow,Fog\"</td>\n",
       "      <td>4</td>\n",
       "      <td>18</td>\n",
       "      <td>50</td>\n",
       "      <td>50</td>\n",
       "      <td>52</td>\n",
       "      <td>54545</td>\n",
       "      <td>49.20573</td>\n",
       "      <td>-123.14077</td>\n",
       "      <td>54547</td>\n",
       "      <td>49.20359</td>\n",
       "      <td>-123.13671</td>\n",
       "      <td>54545 -&gt; 54547</td>\n",
       "      <td>387</td>\n",
       "      <td>39</td>\n",
       "      <td>900</td>\n",
       "      <td>1064</td>\n",
       "      <td>1</td>\n",
       "      <td>-164</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>56739</td>\n",
       "      <td>56788</td>\n",
       "      <td>56813</td>\n",
       "      <td>56838</td>\n",
       "      <td>52</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>12</td>\n",
       "      <td>31</td>\n",
       "      <td>5</td>\n",
       "      <td>366</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>1483142400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142636</th>\n",
       "      <td>Saturday</td>\n",
       "      <td>2562</td>\n",
       "      <td>52</td>\n",
       "      <td>21633</td>\n",
       "      <td>010 - SB1DT</td>\n",
       "      <td>010 - SB1DT - 15:02</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>EB SW MARINE DR AT LAUREL ST</td>\n",
       "      <td>19</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>19</td>\n",
       "      <td>15:50:33</td>\n",
       "      <td>15:51:22</td>\n",
       "      <td>15:50:33</td>\n",
       "      <td>15:51:22</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>64</td>\n",
       "      <td>-53</td>\n",
       "      <td>-105</td>\n",
       "      <td>0</td>\n",
       "      <td>0.6</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>97</td>\n",
       "      <td>\"Rain,Snow,Fog\"</td>\n",
       "      <td>4</td>\n",
       "      <td>18</td>\n",
       "      <td>114</td>\n",
       "      <td>50</td>\n",
       "      <td>56</td>\n",
       "      <td>54664</td>\n",
       "      <td>49.20435</td>\n",
       "      <td>-123.13068</td>\n",
       "      <td>55818</td>\n",
       "      <td>49.20644</td>\n",
       "      <td>-123.1257</td>\n",
       "      <td>54664 -&gt; 55818</td>\n",
       "      <td>431</td>\n",
       "      <td>42</td>\n",
       "      <td>900</td>\n",
       "      <td>1096</td>\n",
       "      <td>0</td>\n",
       "      <td>-196</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>100</td>\n",
       "      <td>56931</td>\n",
       "      <td>57036</td>\n",
       "      <td>57033</td>\n",
       "      <td>57086</td>\n",
       "      <td>56</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>12</td>\n",
       "      <td>31</td>\n",
       "      <td>5</td>\n",
       "      <td>366</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>1483142400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142637</th>\n",
       "      <td>Saturday</td>\n",
       "      <td>2562</td>\n",
       "      <td>52</td>\n",
       "      <td>21633</td>\n",
       "      <td>010 - SB1DT</td>\n",
       "      <td>010 - SB1DT - 15:02</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>EB SW MARINE DR AT HEATHER ST</td>\n",
       "      <td>19</td>\n",
       "      <td>5</td>\n",
       "      <td>2</td>\n",
       "      <td>22</td>\n",
       "      <td>15:51:10</td>\n",
       "      <td>15:51:41</td>\n",
       "      <td>15:51:10</td>\n",
       "      <td>15:51:56</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>0</td>\n",
       "      <td>-29</td>\n",
       "      <td>-53</td>\n",
       "      <td>3</td>\n",
       "      <td>0.6</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>97</td>\n",
       "      <td>\"Rain,Snow,Fog\"</td>\n",
       "      <td>4</td>\n",
       "      <td>18</td>\n",
       "      <td>13</td>\n",
       "      <td>13</td>\n",
       "      <td>57</td>\n",
       "      <td>55818</td>\n",
       "      <td>49.20644</td>\n",
       "      <td>-123.1257</td>\n",
       "      <td>55815</td>\n",
       "      <td>49.20718</td>\n",
       "      <td>-123.12387</td>\n",
       "      <td>55818 -&gt; 55815</td>\n",
       "      <td>158</td>\n",
       "      <td>15</td>\n",
       "      <td>900</td>\n",
       "      <td>1077</td>\n",
       "      <td>1</td>\n",
       "      <td>-177</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>100</td>\n",
       "      <td>57033</td>\n",
       "      <td>57086</td>\n",
       "      <td>57070</td>\n",
       "      <td>57099</td>\n",
       "      <td>57</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>12</td>\n",
       "      <td>31</td>\n",
       "      <td>5</td>\n",
       "      <td>366</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>1483142400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142638</th>\n",
       "      <td>Saturday</td>\n",
       "      <td>2562</td>\n",
       "      <td>52</td>\n",
       "      <td>21633</td>\n",
       "      <td>010 - SB1DT</td>\n",
       "      <td>010 - SB1DT - 15:02</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>EB SW MARINE DR AT W 70 AVE</td>\n",
       "      <td>22</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>19</td>\n",
       "      <td>15:52:14</td>\n",
       "      <td>15:52:32</td>\n",
       "      <td>15:52:14</td>\n",
       "      <td>15:52:47</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>21</td>\n",
       "      <td>-20</td>\n",
       "      <td>-50</td>\n",
       "      <td>-3</td>\n",
       "      <td>0.6</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>97</td>\n",
       "      <td>\"Rain,Snow,Fog\"</td>\n",
       "      <td>4</td>\n",
       "      <td>18</td>\n",
       "      <td>55</td>\n",
       "      <td>34</td>\n",
       "      <td>58</td>\n",
       "      <td>55815</td>\n",
       "      <td>49.20718</td>\n",
       "      <td>-123.12387</td>\n",
       "      <td>55816</td>\n",
       "      <td>49.2085</td>\n",
       "      <td>-123.12075</td>\n",
       "      <td>55815 -&gt; 55816</td>\n",
       "      <td>270</td>\n",
       "      <td>27</td>\n",
       "      <td>900</td>\n",
       "      <td>1089</td>\n",
       "      <td>0</td>\n",
       "      <td>-189</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>100</td>\n",
       "      <td>57070</td>\n",
       "      <td>57120</td>\n",
       "      <td>57134</td>\n",
       "      <td>57154</td>\n",
       "      <td>58</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>12</td>\n",
       "      <td>31</td>\n",
       "      <td>5</td>\n",
       "      <td>366</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>1483142400</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142639</th>\n",
       "      <td>Saturday</td>\n",
       "      <td>2562</td>\n",
       "      <td>52</td>\n",
       "      <td>21633</td>\n",
       "      <td>010 - SB1DT</td>\n",
       "      <td>010 - SB1DT - 15:02</td>\n",
       "      <td>010</td>\n",
       "      <td>N</td>\n",
       "      <td>1</td>\n",
       "      <td>63</td>\n",
       "      <td>EB SW MARINE DR AT ASH ST</td>\n",
       "      <td>19</td>\n",
       "      <td>0</td>\n",
       "      <td>24</td>\n",
       "      <td>-5</td>\n",
       "      <td>15:52:57</td>\n",
       "      <td>15:55:35</td>\n",
       "      <td>15:52:57</td>\n",
       "      <td>15:56:27</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>N</td>\n",
       "      <td>16</td>\n",
       "      <td>-16</td>\n",
       "      <td>-36</td>\n",
       "      <td>-24</td>\n",
       "      <td>0.6</td>\n",
       "      <td>FALSE</td>\n",
       "      <td>97</td>\n",
       "      <td>\"Rain,Snow,Fog\"</td>\n",
       "      <td>4</td>\n",
       "      <td>18</td>\n",
       "      <td>39</td>\n",
       "      <td>23</td>\n",
       "      <td>59</td>\n",
       "      <td>55816</td>\n",
       "      <td>49.2085</td>\n",
       "      <td>-123.12075</td>\n",
       "      <td>55817</td>\n",
       "      <td>49.20939</td>\n",
       "      <td>-123.1186</td>\n",
       "      <td>55816 -&gt; 55817</td>\n",
       "      <td>187</td>\n",
       "      <td>22</td>\n",
       "      <td>900</td>\n",
       "      <td>1087</td>\n",
       "      <td>0</td>\n",
       "      <td>-187</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>100</td>\n",
       "      <td>57134</td>\n",
       "      <td>57170</td>\n",
       "      <td>57177</td>\n",
       "      <td>57193</td>\n",
       "      <td>59</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2016</td>\n",
       "      <td>12</td>\n",
       "      <td>31</td>\n",
       "      <td>5</td>\n",
       "      <td>366</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>True</td>\n",
       "      <td>False</td>\n",
       "      <td>1483142400</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>142640 rows × 71 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         DayType VehicleNo  Week BlockNo      Pattern                 Trip  \\\n",
       "0        Mon-Fri      2553    35   34132  010 - NB1DT  010 - NB1DT - 04:53   \n",
       "1        Mon-Fri      2553    35   34132  010 - NB1DT  010 - NB1DT - 04:53   \n",
       "2        Mon-Fri      2553    35   34132  010 - NB1DT  010 - NB1DT - 04:53   \n",
       "3        Mon-Fri      2553    35   34132  010 - NB1DT  010 - NB1DT - 04:53   \n",
       "4        Mon-Fri      2553    35   34132  010 - NB1DT  010 - NB1DT - 04:53   \n",
       "...          ...       ...   ...     ...          ...                  ...   \n",
       "142635  Saturday      2562    52   21633  010 - SB1DT  010 - SB1DT - 15:02   \n",
       "142636  Saturday      2562    52   21633  010 - SB1DT  010 - SB1DT - 15:02   \n",
       "142637  Saturday      2562    52   21633  010 - SB1DT  010 - SB1DT - 15:02   \n",
       "142638  Saturday      2562    52   21633  010 - SB1DT  010 - SB1DT - 15:02   \n",
       "142639  Saturday      2562    52   21633  010 - SB1DT  010 - SB1DT - 15:02   \n",
       "\n",
       "       Line TimingPoint  MinStopNo  MaxStopNo  \\\n",
       "0       010           N          1         63   \n",
       "1       010           N          1         63   \n",
       "2       010           N          1         63   \n",
       "3       010           N          1         63   \n",
       "4       010           N          1         63   \n",
       "...     ...         ...        ...        ...   \n",
       "142635  010           N          1         63   \n",
       "142636  010           N          1         63   \n",
       "142637  010           N          1         63   \n",
       "142638  010           N          1         63   \n",
       "142639  010           N          1         63   \n",
       "\n",
       "                               StopName ArriveLoadCompensated  \\\n",
       "0         WB SW MARINE DR AT HEATHER ST                     1   \n",
       "1          WB SW MARINE DR AT LAUREL ST                     1   \n",
       "2             WB SW MARINE DR AT OAK ST                     2   \n",
       "3       WB SW MARINE DR AT GRANVILLE ST                    -1   \n",
       "4           NB GRANVILLE ST AT W 71 AVE                    -1   \n",
       "...                                 ...                   ...   \n",
       "142635   EB SW MARINE DR AT MONTCALM ST                    17   \n",
       "142636     EB SW MARINE DR AT LAUREL ST                    19   \n",
       "142637    EB SW MARINE DR AT HEATHER ST                    19   \n",
       "142638      EB SW MARINE DR AT W 70 AVE                    22   \n",
       "142639        EB SW MARINE DR AT ASH ST                    19   \n",
       "\n",
       "       OnsLoadCompensated OffsLoadCompensated LeaveLoadCompensated  \\\n",
       "0                       0                   0                    1   \n",
       "1                       1                   0                    2   \n",
       "2                       0                   0                    2   \n",
       "3                       0                   0                   -1   \n",
       "4                       2                   0                    1   \n",
       "...                   ...                 ...                  ...   \n",
       "142635                  0                   4                   13   \n",
       "142636                  0                   0                   19   \n",
       "142637                  5                   2                   22   \n",
       "142638                  0                   3                   19   \n",
       "142639                  0                  24                   -5   \n",
       "\n",
       "       ScheduledArriveTime ActualArriveTime ScheduledLeaveTime  \\\n",
       "0                 04:55:34         04:54:41           04:55:34   \n",
       "1                 04:56:24         04:55:15           04:56:24   \n",
       "2                 04:57:37         04:56:01           04:57:37   \n",
       "3                 04:59:54         04:59:47           04:59:54   \n",
       "4                 05:00:41         05:00:33           05:00:41   \n",
       "...                    ...              ...                ...   \n",
       "142635            15:46:53         15:47:17           15:46:53   \n",
       "142636            15:50:33         15:51:22           15:50:33   \n",
       "142637            15:51:10         15:51:41           15:51:10   \n",
       "142638            15:52:14         15:52:32           15:52:14   \n",
       "142639            15:52:57         15:55:35           15:52:57   \n",
       "\n",
       "       ActualLeaveTime WCLiftActivated BikeLoaded BikeUnloaded DwellTime  \\\n",
       "0             04:54:41               N          N            N         0   \n",
       "1             04:55:23               N          N            N         0   \n",
       "2             04:56:01               N          N            N        13   \n",
       "3             04:59:47               N          N            N         0   \n",
       "4             05:00:54               N          N            N         0   \n",
       "...                ...             ...        ...          ...       ...   \n",
       "142635        15:47:34               N          N            N         0   \n",
       "142636        15:51:22               N          N            N        64   \n",
       "142637        15:51:56               N          N            N         0   \n",
       "142638        15:52:47               N          N            N        21   \n",
       "142639        15:56:27               N          N            N        16   \n",
       "\n",
       "        ArriveDelay  DepartureDelay  OnsAndOffsCompensated  Temp    Dew  \\\n",
       "0                42               5                      0  12.9  FALSE   \n",
       "1                71              42                      1  12.9  FALSE   \n",
       "2                81              58                      0  12.9  FALSE   \n",
       "3                -9             -22                      0  12.9  FALSE   \n",
       "4                 8              -9                      2  13.1  FALSE   \n",
       "...             ...             ...                    ...   ...    ...   \n",
       "142635          -25             -49                     -4   0.6  FALSE   \n",
       "142636          -53            -105                      0   0.6  FALSE   \n",
       "142637          -29             -53                      3   0.6  FALSE   \n",
       "142638          -20             -50                     -3   0.6  FALSE   \n",
       "142639          -16             -36                    -24   0.6  FALSE   \n",
       "\n",
       "       Humidity       Conditions Visibility Wind.Speed  StopToStopTime  \\\n",
       "0            96     Mainly Clear       48.3         10              35   \n",
       "1            96     Mainly Clear       48.3         10              21   \n",
       "2            96     Mainly Clear       48.3         10              63   \n",
       "3            96     Mainly Clear       48.3         10              22   \n",
       "4            96     Mainly Clear       48.3          7              30   \n",
       "...         ...              ...        ...        ...             ...   \n",
       "142635       97  \"Rain,Snow,Fog\"          4         18              50   \n",
       "142636       97  \"Rain,Snow,Fog\"          4         18             114   \n",
       "142637       97  \"Rain,Snow,Fog\"          4         18              13   \n",
       "142638       97  \"Rain,Snow,Fog\"          4         18              55   \n",
       "142639       97  \"Rain,Snow,Fog\"          4         18              39   \n",
       "\n",
       "        TravelTime TripLeg Origin OriginLat  OriginLong Destination    GPSLat  \\\n",
       "0               35       2  55896  49.20914  -123.11976       55670  49.20741   \n",
       "1               21       3  55670  49.20741  -123.12395       55898  49.20618   \n",
       "2               50       4  55898  49.20618  -123.12682       54736  49.20453   \n",
       "3               22       8  54681  49.20417  -123.13726       54682  49.20505   \n",
       "4               30       9  54682  49.20505  -123.13988       54692  49.20743   \n",
       "...            ...     ...    ...       ...         ...         ...       ...   \n",
       "142635          50      52  54545  49.20573  -123.14077       54547  49.20359   \n",
       "142636          50      56  54664  49.20435  -123.13068       55818  49.20644   \n",
       "142637          13      57  55818  49.20644   -123.1257       55815  49.20718   \n",
       "142638          34      58  55815  49.20718  -123.12387       55816   49.2085   \n",
       "142639          23      59  55816   49.2085  -123.12075       55817  49.20939   \n",
       "\n",
       "           GPSLong      Start.Stop  Distance.GglMps  Duration.GglMps  \\\n",
       "0       -123.12395  55896 -> 55670              361               37   \n",
       "1       -123.12682  55670 -> 55898              250               24   \n",
       "2       -123.13107  55898 -> 54736              359               37   \n",
       "3       -123.13988  54681 -> 54682              214               22   \n",
       "4       -123.14041  54682 -> 54692              289               43   \n",
       "...            ...             ...              ...              ...   \n",
       "142635  -123.13671  54545 -> 54547              387               39   \n",
       "142636   -123.1257  54664 -> 55818              431               42   \n",
       "142637  -123.12387  55818 -> 55815              158               15   \n",
       "142638  -123.12075  55815 -> 55816              270               27   \n",
       "142639   -123.1186  55816 -> 55817              187               22   \n",
       "\n",
       "       ScheduledHeadway ActualHeadway HeadwayWithinTarget HeadwayOffset  \\\n",
       "0                   600           518                   1            82   \n",
       "1                   600           514                   1            86   \n",
       "2                   600           525                   1            75   \n",
       "3                   600           531                   1            69   \n",
       "4                   600           535                   1            65   \n",
       "...                 ...           ...                 ...           ...   \n",
       "142635              900          1064                   1          -164   \n",
       "142636              900          1096                   0          -196   \n",
       "142637              900          1077                   1          -177   \n",
       "142638              900          1089                   0          -189   \n",
       "142639              900          1087                   0          -187   \n",
       "\n",
       "       BusBunchingFlag BusGappingFlag TripPatternCompleteness  \\\n",
       "0                    0              0                     100   \n",
       "1                    0              0                     100   \n",
       "2                    0              0                     100   \n",
       "3                    0              0                     100   \n",
       "4                    0              0                     100   \n",
       "...                ...            ...                     ...   \n",
       "142635               0              0                     100   \n",
       "142636               0              1                     100   \n",
       "142637               0              0                     100   \n",
       "142638               0              1                     100   \n",
       "142639               0              1                     100   \n",
       "\n",
       "        StartScheduledLeaveTimeSeconds  StartActualLeaveTimeSeconds  \\\n",
       "0                                17662                        17657   \n",
       "1                                17734                        17692   \n",
       "2                                17784                        17726   \n",
       "3                                17959                        17981   \n",
       "4                                17994                        18003   \n",
       "...                                ...                          ...   \n",
       "142635                           56739                        56788   \n",
       "142636                           56931                        57036   \n",
       "142637                           57033                        57086   \n",
       "142638                           57070                        57120   \n",
       "142639                           57134                        57170   \n",
       "\n",
       "        StopScheduledArriveTiemSeconds  StopActualArriveTimeSeconds  \\\n",
       "0                                17734                        17692   \n",
       "1                                17784                        17713   \n",
       "2                                17857                        17776   \n",
       "3                                17994                        18003   \n",
       "4                                18041                        18033   \n",
       "...                                ...                          ...   \n",
       "142635                           56813                        56838   \n",
       "142636                           57033                        57086   \n",
       "142637                           57070                        57099   \n",
       "142638                           57134                        57154   \n",
       "142639                           57177                        57193   \n",
       "\n",
       "        TripLegInt  NextLegBunchingFlag  NextNextLegBunchingFlag  \\\n",
       "0                2                    0                        0   \n",
       "1                3                    0                        0   \n",
       "2                4                    0                        0   \n",
       "3                8                    0                        0   \n",
       "4                9                    0                        0   \n",
       "...            ...                  ...                      ...   \n",
       "142635          52                    0                        0   \n",
       "142636          56                    0                        0   \n",
       "142637          57                    0                        0   \n",
       "142638          58                    0                        0   \n",
       "142639          59                    0                        0   \n",
       "\n",
       "        NextNextNextLegBunchingFlag  OperationYear  OperationMonth  \\\n",
       "0                                 0           2016               9   \n",
       "1                                 0           2016               9   \n",
       "2                                 0           2016               9   \n",
       "3                                 0           2016               9   \n",
       "4                                 0           2016               9   \n",
       "...                             ...            ...             ...   \n",
       "142635                            0           2016              12   \n",
       "142636                            0           2016              12   \n",
       "142637                            0           2016              12   \n",
       "142638                            0           2016              12   \n",
       "142639                            0           2016              12   \n",
       "\n",
       "        OperationDay  OperationDayofweek  OperationDayofyear  \\\n",
       "0                  1                   3                 245   \n",
       "1                  1                   3                 245   \n",
       "2                  1                   3                 245   \n",
       "3                  1                   3                 245   \n",
       "4                  1                   3                 245   \n",
       "...              ...                 ...                 ...   \n",
       "142635            31                   5                 366   \n",
       "142636            31                   5                 366   \n",
       "142637            31                   5                 366   \n",
       "142638            31                   5                 366   \n",
       "142639            31                   5                 366   \n",
       "\n",
       "        OperationIs_month_end  OperationIs_month_start  \\\n",
       "0                       False                     True   \n",
       "1                       False                     True   \n",
       "2                       False                     True   \n",
       "3                       False                     True   \n",
       "4                       False                     True   \n",
       "...                       ...                      ...   \n",
       "142635                   True                    False   \n",
       "142636                   True                    False   \n",
       "142637                   True                    False   \n",
       "142638                   True                    False   \n",
       "142639                   True                    False   \n",
       "\n",
       "        OperationIs_quarter_end  OperationIs_quarter_start  \\\n",
       "0                         False                      False   \n",
       "1                         False                      False   \n",
       "2                         False                      False   \n",
       "3                         False                      False   \n",
       "4                         False                      False   \n",
       "...                         ...                        ...   \n",
       "142635                     True                      False   \n",
       "142636                     True                      False   \n",
       "142637                     True                      False   \n",
       "142638                     True                      False   \n",
       "142639                     True                      False   \n",
       "\n",
       "        OperationIs_year_end  OperationIs_year_start  OperationElapsed  \n",
       "0                      False                   False        1472688000  \n",
       "1                      False                   False        1472688000  \n",
       "2                      False                   False        1472688000  \n",
       "3                      False                   False        1472688000  \n",
       "4                      False                   False        1472688000  \n",
       "...                      ...                     ...               ...  \n",
       "142635                  True                   False        1483142400  \n",
       "142636                  True                   False        1483142400  \n",
       "142637                  True                   False        1483142400  \n",
       "142638                  True                   False        1483142400  \n",
       "142639                  True                   False        1483142400  \n",
       "\n",
       "[142640 rows x 71 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "display_all(df)\n",
    "#df.head(3).transpose()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Data Preprocessing"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DayType                      0\n",
       "VehicleNo                    0\n",
       "Week                         0\n",
       "BlockNo                      0\n",
       "Pattern                      0\n",
       "                            ..\n",
       "OperationIs_quarter_end      0\n",
       "OperationIs_quarter_start    0\n",
       "OperationIs_year_end         0\n",
       "OperationIs_year_start       0\n",
       "OperationElapsed             0\n",
       "Length: 71, dtype: int64"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Check for NaN values in the data.\n",
    "df.isnull().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Remove NaN values from the data.\n",
    "df=df.dropna()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Drop the dew column"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['FALSE'], dtype=object)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.Dew.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "Int64Index: 138752 entries, 0 to 142639\n",
      "Data columns (total 71 columns):\n",
      " #   Column                          Non-Null Count   Dtype \n",
      "---  ------                          --------------   ----- \n",
      " 0   DayType                         138752 non-null  object\n",
      " 1   VehicleNo                       138752 non-null  object\n",
      " 2   Week                            138752 non-null  UInt32\n",
      " 3   BlockNo                         138752 non-null  object\n",
      " 4   Pattern                         138752 non-null  object\n",
      " 5   Trip                            138752 non-null  object\n",
      " 6   Line                            138752 non-null  object\n",
      " 7   TimingPoint                     138752 non-null  object\n",
      " 8   MinStopNo                       138752 non-null  int64 \n",
      " 9   MaxStopNo                       138752 non-null  int64 \n",
      " 10  StopName                        138752 non-null  object\n",
      " 11  ArriveLoadCompensated           138752 non-null  object\n",
      " 12  OnsLoadCompensated              138752 non-null  object\n",
      " 13  OffsLoadCompensated             138752 non-null  object\n",
      " 14  LeaveLoadCompensated            138752 non-null  object\n",
      " 15  ScheduledArriveTime             138752 non-null  object\n",
      " 16  ActualArriveTime                138752 non-null  object\n",
      " 17  ScheduledLeaveTime              138752 non-null  object\n",
      " 18  ActualLeaveTime                 138752 non-null  object\n",
      " 19  WCLiftActivated                 138752 non-null  object\n",
      " 20  BikeLoaded                      138752 non-null  object\n",
      " 21  BikeUnloaded                    138752 non-null  object\n",
      " 22  DwellTime                       138752 non-null  object\n",
      " 23  ArriveDelay                     138752 non-null  int64 \n",
      " 24  DepartureDelay                  138752 non-null  int64 \n",
      " 25  OnsAndOffsCompensated           138752 non-null  int64 \n",
      " 26  Temp                            138752 non-null  object\n",
      " 27  Dew                             138752 non-null  object\n",
      " 28  Humidity                        138752 non-null  object\n",
      " 29  Conditions                      138752 non-null  object\n",
      " 30  Visibility                      138752 non-null  object\n",
      " 31  Wind.Speed                      138752 non-null  object\n",
      " 32  StopToStopTime                  138752 non-null  int64 \n",
      " 33  TravelTime                      138752 non-null  int64 \n",
      " 34  TripLeg                         138752 non-null  object\n",
      " 35  Origin                          138752 non-null  object\n",
      " 36  OriginLat                       138752 non-null  object\n",
      " 37  OriginLong                      138752 non-null  object\n",
      " 38  Destination                     138752 non-null  object\n",
      " 39  GPSLat                          138752 non-null  object\n",
      " 40  GPSLong                         138752 non-null  object\n",
      " 41  Start.Stop                      138752 non-null  object\n",
      " 42  Distance.GglMps                 138752 non-null  int64 \n",
      " 43  Duration.GglMps                 138752 non-null  int64 \n",
      " 44  ScheduledHeadway                138752 non-null  object\n",
      " 45  ActualHeadway                   138752 non-null  object\n",
      " 46  HeadwayWithinTarget             138752 non-null  object\n",
      " 47  HeadwayOffset                   138752 non-null  object\n",
      " 48  BusBunchingFlag                 138752 non-null  object\n",
      " 49  BusGappingFlag                  138752 non-null  object\n",
      " 50  TripPatternCompleteness         138752 non-null  object\n",
      " 51  StartScheduledLeaveTimeSeconds  138752 non-null  int64 \n",
      " 52  StartActualLeaveTimeSeconds     138752 non-null  int64 \n",
      " 53  StopScheduledArriveTiemSeconds  138752 non-null  int64 \n",
      " 54  StopActualArriveTimeSeconds     138752 non-null  int64 \n",
      " 55  TripLegInt                      138752 non-null  int64 \n",
      " 56  NextLegBunchingFlag             138752 non-null  int64 \n",
      " 57  NextNextLegBunchingFlag         138752 non-null  int64 \n",
      " 58  NextNextNextLegBunchingFlag     138752 non-null  int64 \n",
      " 59  OperationYear                   138752 non-null  int64 \n",
      " 60  OperationMonth                  138752 non-null  int64 \n",
      " 61  OperationDay                    138752 non-null  int64 \n",
      " 62  OperationDayofweek              138752 non-null  int64 \n",
      " 63  OperationDayofyear              138752 non-null  int64 \n",
      " 64  OperationIs_month_end           138752 non-null  bool  \n",
      " 65  OperationIs_month_start         138752 non-null  bool  \n",
      " 66  OperationIs_quarter_end         138752 non-null  bool  \n",
      " 67  OperationIs_quarter_start       138752 non-null  bool  \n",
      " 68  OperationIs_year_end            138752 non-null  bool  \n",
      " 69  OperationIs_year_start          138752 non-null  bool  \n",
      " 70  OperationElapsed                138752 non-null  int64 \n",
      "dtypes: UInt32(1), bool(6), int64(23), object(41)\n",
      "memory usage: 70.3+ MB\n"
     ]
    }
   ],
   "source": [
    "df.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Drop the unnecessary columns.\n",
    "df=df.drop(['Line','Trip','TimingPoint','MinStopNo','MaxStopNo','ScheduledArriveTime','ActualArriveTime',\\\n",
    "              'ScheduledLeaveTime','ActualLeaveTime','Origin','Dew','Destination','Start.Stop','BusBunchingFlag',\\\n",
    "              'TripPatternCompleteness','TripLegInt',\\\n",
    "            ],axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Change dtype from object to interger and float\n",
    "df[['Temp','Visibility','OriginLat','OriginLong','GPSLat','GPSLong']] = df[['Temp','Visibility','OriginLat',\\\n",
    "                                                                              'OriginLong','GPSLat','GPSLong']].astype('float64', copy=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Change dtype from object to interger and float. I found out that there are 'NULL' values in the ScheduledHeadway,ActualHeadway,HeadwayOffset columns. \n",
    "# So using the following method with errors set to coerce option which sets the value to NaN if it is NULL. So that NaNs can \n",
    "# be removed later.\n",
    "featnum=['VehicleNo','BlockNo','ArriveLoadCompensated','OnsLoadCompensated','OffsLoadCompensated',\\\n",
    "         'LeaveLoadCompensated','OnsAndOffsCompensated','DwellTime','TravelTime', 'Humidity','Wind.Speed',\\\n",
    "         'TripLeg','ScheduledHeadway','ActualHeadway','HeadwayOffset']\n",
    "for i in featnum:\n",
    "    df[i] = pd.to_numeric(df[i], errors='coerce')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DayType                              0\n",
       "VehicleNo                            0\n",
       "Week                                 0\n",
       "BlockNo                              0\n",
       "Pattern                              0\n",
       "StopName                             0\n",
       "ArriveLoadCompensated                0\n",
       "OnsLoadCompensated                   0\n",
       "OffsLoadCompensated                  0\n",
       "LeaveLoadCompensated                 0\n",
       "WCLiftActivated                      0\n",
       "BikeLoaded                           0\n",
       "BikeUnloaded                         0\n",
       "DwellTime                            0\n",
       "ArriveDelay                          0\n",
       "DepartureDelay                       0\n",
       "OnsAndOffsCompensated                0\n",
       "Temp                                 0\n",
       "Humidity                             0\n",
       "Conditions                           0\n",
       "Visibility                           0\n",
       "Wind.Speed                           0\n",
       "StopToStopTime                       0\n",
       "TravelTime                           0\n",
       "TripLeg                              0\n",
       "OriginLat                            0\n",
       "OriginLong                           0\n",
       "GPSLat                               0\n",
       "GPSLong                              0\n",
       "Distance.GglMps                      0\n",
       "Duration.GglMps                      0\n",
       "ScheduledHeadway                  1090\n",
       "ActualHeadway                     1120\n",
       "HeadwayWithinTarget                  0\n",
       "HeadwayOffset                     1120\n",
       "BusGappingFlag                       0\n",
       "StartScheduledLeaveTimeSeconds       0\n",
       "StartActualLeaveTimeSeconds          0\n",
       "StopScheduledArriveTiemSeconds       0\n",
       "StopActualArriveTimeSeconds          0\n",
       "NextLegBunchingFlag                  0\n",
       "NextNextLegBunchingFlag              0\n",
       "NextNextNextLegBunchingFlag          0\n",
       "OperationYear                        0\n",
       "OperationMonth                       0\n",
       "OperationDay                         0\n",
       "OperationDayofweek                   0\n",
       "OperationDayofyear                   0\n",
       "OperationIs_month_end                0\n",
       "OperationIs_month_start              0\n",
       "OperationIs_quarter_end              0\n",
       "OperationIs_quarter_start            0\n",
       "OperationIs_year_end                 0\n",
       "OperationIs_year_start               0\n",
       "OperationElapsed                     0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.isnull().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Replace the null values with median.\n",
    "for col in ['ScheduledHeadway','ActualHeadway','HeadwayOffset']:\n",
    "    df[col] = df[col].fillna(df[col].median())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "DayType                            object\n",
       "VehicleNo                           int64\n",
       "Week                               UInt32\n",
       "BlockNo                             int64\n",
       "Pattern                            object\n",
       "StopName                           object\n",
       "ArriveLoadCompensated               int64\n",
       "OnsLoadCompensated                  int64\n",
       "OffsLoadCompensated                 int64\n",
       "LeaveLoadCompensated                int64\n",
       "WCLiftActivated                    object\n",
       "BikeLoaded                         object\n",
       "BikeUnloaded                       object\n",
       "DwellTime                           int64\n",
       "ArriveDelay                         int64\n",
       "DepartureDelay                      int64\n",
       "OnsAndOffsCompensated               int64\n",
       "Temp                              float64\n",
       "Humidity                            int64\n",
       "Conditions                         object\n",
       "Visibility                        float64\n",
       "Wind.Speed                          int64\n",
       "StopToStopTime                      int64\n",
       "TravelTime                          int64\n",
       "TripLeg                             int64\n",
       "OriginLat                         float64\n",
       "OriginLong                        float64\n",
       "GPSLat                            float64\n",
       "GPSLong                           float64\n",
       "Distance.GglMps                     int64\n",
       "Duration.GglMps                     int64\n",
       "ScheduledHeadway                  float64\n",
       "ActualHeadway                     float64\n",
       "HeadwayWithinTarget                object\n",
       "HeadwayOffset                     float64\n",
       "BusGappingFlag                     object\n",
       "StartScheduledLeaveTimeSeconds      int64\n",
       "StartActualLeaveTimeSeconds         int64\n",
       "StopScheduledArriveTiemSeconds      int64\n",
       "StopActualArriveTimeSeconds         int64\n",
       "NextLegBunchingFlag                 int64\n",
       "NextNextLegBunchingFlag             int64\n",
       "NextNextNextLegBunchingFlag         int64\n",
       "OperationYear                       int64\n",
       "OperationMonth                      int64\n",
       "OperationDay                        int64\n",
       "OperationDayofweek                  int64\n",
       "OperationDayofyear                  int64\n",
       "OperationIs_month_end                bool\n",
       "OperationIs_month_start              bool\n",
       "OperationIs_quarter_end              bool\n",
       "OperationIs_quarter_start            bool\n",
       "OperationIs_year_end                 bool\n",
       "OperationIs_year_start               bool\n",
       "OperationElapsed                    int64\n",
       "dtype: object"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.dtypes"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Convert all the string columns to categorical values."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "train_cats(df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Target encode the StopName. \n",
    "Use package category_encoders. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['WB SW MARINE DR AT HEATHER ST', 'WB SW MARINE DR AT LAUREL ST', 'WB SW MARINE DR AT OAK ST', 'WB SW MARINE DR AT GRANVILLE ST', 'NB GRANVILLE ST AT W 71 AVE', ..., 'WB W PENDER ST AT GRANVILLE ST', 'SB HOWE ST AT W GEORGIA ST', 'SB HOWE ST AT ROBSON ST', 'SB HOWE ST AT NELSON ST', 'SB HOWE ST AT DAVIE ST']\n",
       "Length: 83\n",
       "Categories (83, object): ['EB SW MARINE DR AT ASH ST' < 'EB SW MARINE DR AT HEATHER ST' < 'EB SW MARINE DR AT LAUREL ST' < 'EB SW MARINE DR AT MONTCALM ST' ... 'WB SW MARINE DR AT HEATHER ST' < 'WB SW MARINE DR AT LAUREL ST' < 'WB SW MARINE DR AT OAK ST' < 'WB W PENDER ST AT GRANVILLE ST']"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.StopName.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Applications/anaconda3/envs/DNN/lib/python3.7/site-packages/category_encoders/utils.py:21: FutureWarning: is_categorical is deprecated and will be removed in a future version.  Use is_categorical_dtype instead\n",
      "  elif pd.api.types.is_categorical(cols):\n"
     ]
    }
   ],
   "source": [
    "from category_encoders.target_encoder import TargetEncoder\n",
    "df = df.reset_index() # not sure why TargetEncoder needs this but it does\n",
    "targetfeatures = ['StopName']\n",
    "encoder = TargetEncoder(cols=targetfeatures)\n",
    "encoder.fit(df, df['NextLegBunchingFlag'])\n",
    "df_encoded = encoder.transform(df, df['NextLegBunchingFlag'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0.01992, 0.02408, 0.     , 0.03918, 0.04541, 0.051  , 0.03476, 0.05744, 0.06434, 0.06287, 0.06133,\n",
       "       0.06093, 0.06388, 0.04554, 0.05042, 0.05093, 0.04949, 0.04552, 0.04941, 0.04846, 0.0514 , 0.05284,\n",
       "       0.04851, 0.0394 , 0.04049, 0.04432, 0.04379, 0.04386, 0.04561, 0.25   , 0.01695, 0.02564, 0.01709,\n",
       "       0.05033, 0.049  , 0.05329, 0.05647, 0.05755, 0.03913, 0.04573, 0.04858, 0.0464 , 0.04757, 0.05203,\n",
       "       0.0509 , 0.052  , 0.05528, 0.05747, 0.05911, 0.06076, 0.04324, 0.04543, 0.04874, 0.04934, 0.05101,\n",
       "       0.04263, 0.05425, 0.05531, 0.05702, 0.05924, 0.06096, 0.05937, 0.07206, 0.06827, 0.07219, 0.06995,\n",
       "       0.01786])"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_encoded.StopName.unique()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### One hot encode the DayType column\n",
    "- Use pandas get_dummies function"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['Mon-Fri', 'Saturday', 'Sunday/Holidays', 'XMAS Day', 'Boxing Day']\n",
       "Categories (5, object): ['Boxing Day' < 'Mon-Fri' < 'Saturday' < 'Sunday/Holidays' < 'XMAS Day']"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_encoded.DayType.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Boxing Day</th>\n",
       "      <th>Mon-Fri</th>\n",
       "      <th>Saturday</th>\n",
       "      <th>Sunday/Holidays</th>\n",
       "      <th>XMAS Day</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Boxing Day       Mon-Fri          Saturday         Sunday/Holidays  \\\n",
       "0                0                1                0                0   \n",
       "1                0                1                0                0   \n",
       "2                0                1                0                0   \n",
       "3                0                1                0                0   \n",
       "4                0                1                0                0   \n",
       "\n",
       "   XMAS Day         \n",
       "0                0  \n",
       "1                0  \n",
       "2                0  \n",
       "3                0  \n",
       "4                0  "
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "temp = pd.get_dummies(df_encoded['DayType'])\n",
    "temp.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "frames = [df_encoded, temp]\n",
    "df_encoded = pd.concat(frames,axis=1, join='outer', ignore_index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_encoded = df_encoded.drop('DayType',axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<IntegerArray>\n",
       "[35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52]\n",
       "Length: 18, dtype: UInt32"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_encoded.Week.unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "index                                int64\n",
       "VehicleNo                            int64\n",
       "Week                                UInt32\n",
       "BlockNo                              int64\n",
       "Pattern                           category\n",
       "StopName                           float64\n",
       "ArriveLoadCompensated                int64\n",
       "OnsLoadCompensated                   int64\n",
       "OffsLoadCompensated                  int64\n",
       "LeaveLoadCompensated                 int64\n",
       "WCLiftActivated                   category\n",
       "BikeLoaded                        category\n",
       "BikeUnloaded                      category\n",
       "DwellTime                            int64\n",
       "ArriveDelay                          int64\n",
       "DepartureDelay                       int64\n",
       "OnsAndOffsCompensated                int64\n",
       "Temp                               float64\n",
       "Humidity                             int64\n",
       "Conditions                        category\n",
       "Visibility                         float64\n",
       "Wind.Speed                           int64\n",
       "StopToStopTime                       int64\n",
       "TravelTime                           int64\n",
       "TripLeg                              int64\n",
       "OriginLat                          float64\n",
       "OriginLong                         float64\n",
       "GPSLat                             float64\n",
       "GPSLong                            float64\n",
       "Distance.GglMps                      int64\n",
       "Duration.GglMps                      int64\n",
       "ScheduledHeadway                   float64\n",
       "ActualHeadway                      float64\n",
       "HeadwayWithinTarget               category\n",
       "HeadwayOffset                      float64\n",
       "BusGappingFlag                    category\n",
       "StartScheduledLeaveTimeSeconds       int64\n",
       "StartActualLeaveTimeSeconds          int64\n",
       "StopScheduledArriveTiemSeconds       int64\n",
       "StopActualArriveTimeSeconds          int64\n",
       "NextLegBunchingFlag                  int64\n",
       "NextNextLegBunchingFlag              int64\n",
       "NextNextNextLegBunchingFlag          int64\n",
       "OperationYear                        int64\n",
       "OperationMonth                       int64\n",
       "OperationDay                         int64\n",
       "OperationDayofweek                   int64\n",
       "OperationDayofyear                   int64\n",
       "OperationIs_month_end                 bool\n",
       "OperationIs_month_start               bool\n",
       "OperationIs_quarter_end               bool\n",
       "OperationIs_quarter_start             bool\n",
       "OperationIs_year_end                  bool\n",
       "OperationIs_year_start                bool\n",
       "OperationElapsed                     int64\n",
       "Boxing Day                           uint8\n",
       "Mon-Fri                              uint8\n",
       "Saturday                             uint8\n",
       "Sunday/Holidays                      uint8\n",
       "XMAS Day                             uint8\n",
       "dtype: object"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "display_all(df_encoded.dtypes)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Save the cleaned dataset.\n",
    "- if saving in csv format loses declared type in the variables\n",
    "- pay attention that category is changed to object when the file is read back."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_encoded.to_csv(f'{current_path}/data/processed/Cleaned_Trips2016_10.csv', index=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_all = pd.read_csv(f'{current_path}/data/processed/Cleaned_Trips2016_10.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "index                               int64\n",
       "VehicleNo                           int64\n",
       "Week                                int64\n",
       "BlockNo                             int64\n",
       "Pattern                            object\n",
       "StopName                          float64\n",
       "ArriveLoadCompensated               int64\n",
       "OnsLoadCompensated                  int64\n",
       "OffsLoadCompensated                 int64\n",
       "LeaveLoadCompensated                int64\n",
       "WCLiftActivated                    object\n",
       "BikeLoaded                         object\n",
       "BikeUnloaded                       object\n",
       "DwellTime                           int64\n",
       "ArriveDelay                         int64\n",
       "DepartureDelay                      int64\n",
       "OnsAndOffsCompensated               int64\n",
       "Temp                              float64\n",
       "Humidity                            int64\n",
       "Conditions                         object\n",
       "Visibility                        float64\n",
       "Wind.Speed                          int64\n",
       "StopToStopTime                      int64\n",
       "TravelTime                          int64\n",
       "TripLeg                             int64\n",
       "OriginLat                         float64\n",
       "OriginLong                        float64\n",
       "GPSLat                            float64\n",
       "GPSLong                           float64\n",
       "Distance.GglMps                     int64\n",
       "Duration.GglMps                     int64\n",
       "ScheduledHeadway                  float64\n",
       "ActualHeadway                     float64\n",
       "HeadwayWithinTarget               float64\n",
       "HeadwayOffset                     float64\n",
       "BusGappingFlag                    float64\n",
       "StartScheduledLeaveTimeSeconds      int64\n",
       "StartActualLeaveTimeSeconds         int64\n",
       "StopScheduledArriveTiemSeconds      int64\n",
       "StopActualArriveTimeSeconds         int64\n",
       "NextLegBunchingFlag                 int64\n",
       "NextNextLegBunchingFlag             int64\n",
       "NextNextNextLegBunchingFlag         int64\n",
       "OperationYear                       int64\n",
       "OperationMonth                      int64\n",
       "OperationDay                        int64\n",
       "OperationDayofweek                  int64\n",
       "OperationDayofyear                  int64\n",
       "OperationIs_month_end                bool\n",
       "OperationIs_month_start              bool\n",
       "OperationIs_quarter_end              bool\n",
       "OperationIs_quarter_start            bool\n",
       "OperationIs_year_end                 bool\n",
       "OperationIs_year_start               bool\n",
       "OperationElapsed                    int64\n",
       "Boxing Day                          int64\n",
       "Mon-Fri                             int64\n",
       "Saturday                            int64\n",
       "Sunday/Holidays                     int64\n",
       "XMAS Day                            int64\n",
       "dtype: object"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "display_all(df_all.dtypes)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Save in feather. \n",
    "- this makes sure all processing done so far is valid after saving the file."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_encoded.to_feather(f'{current_path}/data/processed/Cleaned_Trips2016_10.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_all = pd.read_feather(f'{current_path}/data/processed/Cleaned_Trips2016_10.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "index                                int64\n",
       "VehicleNo                            int64\n",
       "Week                                UInt32\n",
       "BlockNo                              int64\n",
       "Pattern                           category\n",
       "StopName                           float64\n",
       "ArriveLoadCompensated                int64\n",
       "OnsLoadCompensated                   int64\n",
       "OffsLoadCompensated                  int64\n",
       "LeaveLoadCompensated                 int64\n",
       "WCLiftActivated                   category\n",
       "BikeLoaded                        category\n",
       "BikeUnloaded                      category\n",
       "DwellTime                            int64\n",
       "ArriveDelay                          int64\n",
       "DepartureDelay                       int64\n",
       "OnsAndOffsCompensated                int64\n",
       "Temp                               float64\n",
       "Humidity                             int64\n",
       "Conditions                        category\n",
       "Visibility                         float64\n",
       "Wind.Speed                           int64\n",
       "StopToStopTime                       int64\n",
       "TravelTime                           int64\n",
       "TripLeg                              int64\n",
       "OriginLat                          float64\n",
       "OriginLong                         float64\n",
       "GPSLat                             float64\n",
       "GPSLong                            float64\n",
       "Distance.GglMps                      int64\n",
       "Duration.GglMps                      int64\n",
       "ScheduledHeadway                   float64\n",
       "ActualHeadway                      float64\n",
       "HeadwayWithinTarget               category\n",
       "HeadwayOffset                      float64\n",
       "BusGappingFlag                    category\n",
       "StartScheduledLeaveTimeSeconds       int64\n",
       "StartActualLeaveTimeSeconds          int64\n",
       "StopScheduledArriveTiemSeconds       int64\n",
       "StopActualArriveTimeSeconds          int64\n",
       "NextLegBunchingFlag                  int64\n",
       "NextNextLegBunchingFlag              int64\n",
       "NextNextNextLegBunchingFlag          int64\n",
       "OperationYear                        int64\n",
       "OperationMonth                       int64\n",
       "OperationDay                         int64\n",
       "OperationDayofweek                   int64\n",
       "OperationDayofyear                   int64\n",
       "OperationIs_month_end                 bool\n",
       "OperationIs_month_start               bool\n",
       "OperationIs_quarter_end               bool\n",
       "OperationIs_quarter_start             bool\n",
       "OperationIs_year_end                  bool\n",
       "OperationIs_year_start                bool\n",
       "OperationElapsed                     int64\n",
       "Boxing Day                           uint8\n",
       "Mon-Fri                              uint8\n",
       "Saturday                             uint8\n",
       "Sunday/Holidays                      uint8\n",
       "XMAS Day                             uint8\n",
       "dtype: object"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "display_all(df_all.dtypes)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
